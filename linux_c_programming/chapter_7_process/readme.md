进程控制
========

#### 进程概述
操作系统的主要任务是管理计算机的软硬件资源。  
现代操作系统的主要特点在于程序的并行执行  
操作系统借助于进程管理计算机的软、硬件资源，支持多任务的并行执行。
操作系统最核心的概念就是进程。

linux是一个多用户多任务的操作系统。
进程是操作系统资源管理的最小单位。

进程标识：唯一进程ID标识，非负数
获取进程标识符
> unistd.h
> pid_t getpid(id)      获得进程ID
> pid_t getppid(id)		获得进程父进程ID
> pid_t getuid()		获得进程的实际用户ID
> pid_t geteuid()		获得进程的有效用户ID
> pid_t getgid()		获得进程的实际组ID
> pid_t getegid(id)		获得进程的有效组ID

Linux 进程的结构
> |代码段              |数据段                      |堆栈段                |
> |--------------------|----------------------------|----------------------|
> |存放程序的可执行代码|存放全局变量、常量、静态变量|存放动态分配的内存变量|

Linux 进程状态
> * 运行状态 R(Runnable)
> * 可中断状态 S(Sleeping)
> * 不可中断状态 D(uninterruptible sleep)
> * 僵死状态 Z(Zombile)
> * 停止状态 T(Thread or Stopped)

#### 进程控制

	1. 创建进程
	2. 退出进程
	3. 执行新程序
	4. 改变进程优先级

##### 1. 创建进程
系统调用fork是创建一个新进程的唯一方法。
> \#include <sys/types.h>
> \#include <unistd.h>
> pid_t fork(void);  

进程创建成功，在父进程中返回子进程ID，在子进程中返回O。
fork之后是父进程先执行还是子进程先执行是不确定的，这取决于内核所使用的调度算法。
子进程会继承父进程的很多属性，主要包括用户ID、组ID、当前工目录、根目录、打开的文件、创建文件时使用的屏蔽字、信号屏蔽字、上下文环境、共享的存储段、资源限制等。
还用一些不同的属性，主要有如下这些。
> * 子进程有它自己唯一的进程ID
> * fork的返回值不同，父进程返回子进程的ID，子进程的则为O
> * 不同的父进程ID。子进程的父进程ID为创建它的父进程ID
> * 子进程共享父进程打开的文件描述符，但父进程对文件描述符的改变不会影响子进程中的文件描述符
> * 子进程不继承父进程设置的文件锁
> * 子进程不继承父进程设置的警告
> * 子进程的未决信号集被清空

##### 1.1 孤儿进程
如果一个子进程的父进程先于子进程结束，子进程就成为一个孤儿进程，它有init进程收养，成为init进程的子进程。

##### 1.2 vfork函数
vfork也可以用来创建一个新进程。
和fork的区别
> * 使用fork创建一个子进程时，子进程只是完全复制父进程的资源。而使用vfork时，并不将父进程的地址空间完全复制到子进程。共享父进程的地址空间。
> * vfork一个进程时，保证子进程先执行。

注意：使用vfork时要谨慎，最好不要允许子进程修改与父进程共享的全局变量和局部变量。

##### 1.3 创建守护进程
守护进程(daemon)是指在后台运行的、没有控制终端与之相连的进程。它独立于控制终端，通常周期性地执行某种任务。
编写守护进程的程序时，要尽量避免产生不必要的交互。有如下要点：
> - 让进城在后台执行。
> - 调用setsid创建一个新对话期、控制终端。
> - 禁止进程重新打开控制终端。
> - 关闭不再需要的文件描述符。
> - 将当前目录更改为根目录。
> - 将文件创建时使用的屏蔽字设置为0。
> - 处理SIGCHILD信号。

##### 1. 退出进程
在Linux系统中进程退出的方法分为正常退出和异常退出两种。
(1) 正常退出
	在main函数中执行return
	调用exit函数
	调用_exit函数
(2) 异常退出
	调用about函数
	进程收到某个信号，而该信号使程序终止
	不管是那种退出方式，最终都会执行内核中的同一段代码。
	各种退出方式的比较
> * exit和return的区别：exit是一个函数，有参数；而return是函数执行完后的返回。exit把控制权交给参数，而return将控制权交给调用函数。
> * exit和abort的区别：exit是正常终止进程，而abort是异常终止。
> * exit(int exit_code): exit中的参数exit_code为0代表进程正常终，若为其他值表示程序执行过程中有错误发生，比如溢出、除数为0。
> * exit()和_exit()的区别：exit在头文件stdlib.h中声明，而_exit()声明在unistd.h中。两个函数均能正常终止进程，但是_exit()会执行后立即返回给内核，而exit()要先执行一些清除操作，然后将控制权交给内核。

##### 1. 执行新程序

使用fork或vfork创建子进程后，子进程通常会调用exec函数来执行另一个程序。系统调用exec用于执行一个可执行程序以代替当前进程的执行映像。

